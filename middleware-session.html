<html>
  <head>
    <title>
      
        Connect - session
      
    </title>
    <link rel='stylesheet' href='main.css' />
  </head>
  <body>
    <div id="content">
      
        <h1>session</h1>
        <span class="filename">lib/middleware/session.js</span>
      

      
      
        
        
        
        
        
        
        
        
        
          <div class="comment">
            
            <p class="description"><p>Setup session store with the given <code>options</code>.</p></p>

            
              <div class="body">
                <p>Session data is <em>not</em> saved in the cookie itself, however
cookies are used, so we must use the <a href="middleware-cookieParser.html">cookieParser()</a>
middleware <em>before</em> <code>session()</code>.</p>

<h2>Examples</h2>

<pre><code>connect.createServer(
    connect.cookieParser()
  , connect.session({ secret: &#39;keyboard cat&#39; })
);</code></pre>

<h2>Options</h2>

<ul><li><code>key</code>           cookie name defaulting to <code>connect.sid</code></li><li><code>store</code>         Session store instance</li><li><code>fingerprint</code>   Custom fingerprint generating function</li><li><code>cookie</code>        Session cookie settings, defaulting to <code>{ path: &#39;/&#39;, httpOnly: true, maxAge: 14400000 }</code></li><li><code>secret</code>        Secret string used to compute hash</li></ul>

<h2>Ignore Paths</h2>

<p> By default <code>/favicon.ico</code> is the only ignored path, all others
 will utilize sessions, to manipulate the paths ignored, use
<code>connect.session.ignore.push(&#39;/my/path&#39;)</code>. This works for <em>full</em>
 pathnames only, not segments nor substrings.</p>

<pre><code>connect.session.ignore.push(&#39;/robots.txt&#39;);</code></pre>

<h2>req.session</h2>

<p> To store or access session data, simply use the request property <code>req.session</code>,
 which is (generally) serialized as JSON by the store, so nested objects 
 are typically fine. For example below is a user-specific view counter:</p>

<pre><code>  connect(
      connect.cookieParser()
    , connect.session({ secret: &#39;keyboard cat&#39;, cookie: { maxAge: 60000 }})
    , connect.favicon()
    , function(req, res, next){
      var sess = req.session;
      if (sess.views) {
        res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;);
        res.write(&#39;&lt;p&gt;views: &#39; + sess.views + &#39;&lt;/p&gt;&#39;);
        res.write(&#39;&lt;p&gt;expires in: &#39; + (sess.cookie.maxAge / 1000) + &#39;s&lt;/p&gt;&#39;);
        res.end();
        sess.views++;
      } else {
        sess.views = 1;
        res.end(&#39;welcome to the session demo. refresh!&#39;);
      }
    }
  ).listen(3000);</code></pre>

<h2>Session#regenerate()</h2>

<p> To regenerate the session simply invoke the method, once complete
 a new SID and <code>Session</code> instance will be initialized at <code>req.session</code>.</p>

<pre><code> req.session.regenerate(function(err){
   // will have a new session here
 });</code></pre>

<h2>Session#destroy()</h2>

<p> Destroys the session, removing <code>req.session</code>, will be re-generated next request.</p>

<pre><code> req.session.destroy(function(err){
   // cannot access session here
 });</code></pre>

<h2>Session#reload()</h2>

<p> Reloads the session data.</p>

<pre><code> req.session.reload(function(err){
   // session updated
 });</code></pre>

<h2>Session#save()</h2>

<p> Save the session.</p>

<pre><code> req.session.save(function(err){
   // session saved
 });</code></pre>

<h2>Session#touch()</h2>

<p>  Updates the <code>.maxAge</code>, and <code>.lastAccess</code> properties. Typically this is
  not necessary to call, as the session middleware does this for you.</p>

<h2>Session#cookie</h2>

<p> Each session has a unique cookie object accompany it. This allows
 you to alter the session cookie per visitor. For example we can
 set <code>req.session.cookie.expires</code> to <code>false</code> to enable the cookie
 to remain for only the duration of the user-agent.</p>

<h2>Session#maxAge</h2>

<p> Alternatively <code>req.session.cookie.maxAge</code> will return the time
 remaining in milliseconds, which we may also re-assign a new value
 to adjust the <code>.expires</code> property appropriately. The following
 are essentially equivalent</p>

<pre><code>var hour = 3600000;
req.session.cookie.expires = new Date(Date.now() + hour);
req.session.cookie.maxAge = hour;</code></pre>

<p>For example when <code>maxAge</code> is set to <code>60000</code> (one minute), and 30 seconds
has elapsed it will return <code>30000</code> until the current request has completed,
at which time <code>req.session.touch()</code> is called to update <code>req.session.lastAccess</code>,
and reset <code>req.session.maxAge</code> to its original value.</p>

<pre><code>req.session.cookie.maxAge;
// =&gt; 30000</code></pre>

<h2>Session Store Implementation</h2>

<p>Every session store <em>must</em> implement the following methods</p>

<ul><li><code>.get(sid, callback)</code></li><li><code>.set(sid, session, callback)</code></li><li><code>.destroy(sid, callback)</code></li></ul>

<p>Recommended methods include, but are not limited to:</p>

<ul><li><code>.length(callback)</code></li><li><code>.clear(callback)</code></li></ul>

<p>For an example implementation view the <a href="http://github.com/visionmedia/connect-redis">connect-redis</a> repo.</p>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">options</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Function</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--             -->
          
          </div>
        
      
      
    </div>
  </body>
</html>